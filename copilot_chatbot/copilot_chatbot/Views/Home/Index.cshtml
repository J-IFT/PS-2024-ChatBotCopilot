@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Bienvenue sur TerraBloom !</h1>
</div>

<div id="chat-window">
    <!-- Zone de chat -->
</div>

<h2>Discutez avec notre bot ! :)</h2>

<div>
    <div id="chat-box" style="height: 400px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px;"></div>
    <input type="text" id="user-input" placeholder="Ecrire un message...">
    <button onclick="sendMessage()">Envoyer</button>

    <!-- Bouton d'import -->
    <div id="file-upload" style="display:none;">
        <input type="file" id="file-input">
        <button onclick="uploadFile()">Importer</button>
    </div>
</div>

@section Scripts {
    <script>
        async function sendMessage() {
            var userInput = document.getElementById("user-input").value;
            document.getElementById("chat-box").innerHTML += `<p>User: ${userInput}</p>`;

            try {
                var response = await fetch('/Product/ChatWithBot', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: userInput })
                });

                if (!response.ok) {
                    var errorData = await response.json();
                    throw new Error(errorData);
                }

                var responseData = await response.json();
                var botResponse = responseData.message;
                document.getElementById("chat-box").innerHTML += `<p>Bot: ${botResponse}</p>`;

                // Afficher le bouton d'import si le message est "import"
                if (userInput.toLowerCase() === "import") {
                    document.getElementById("file-upload").style.display = "block";
                }

            } catch (error) {
                console.error("Erreur lors de l'envoi du message :", error.message);
                document.getElementById("chat-box").innerHTML += `<p>Bot: Erreur lors de l'envoi du message</p>`;
            }
        }

        function uploadFile() {
            // Le code pour envoyer le fichier sera ajouté ici plus tard
        }
    </script>
}
